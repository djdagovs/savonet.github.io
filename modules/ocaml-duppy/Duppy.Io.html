<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Duppy.Async.html">
<link rel="next" href="Duppy.Monad.html">
<link rel="Up" href="Duppy.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Duppy" rel="Chapter" href="Duppy.html">
<link title="Pa_duppy" rel="Chapter" href="Pa_duppy.html"><title>Duppy.Io</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Duppy.Async.html" title="Duppy.Async">Previous</a>
&nbsp;<a class="up" href="Duppy.html" title="Duppy">Up</a>
&nbsp;<a class="post" href="Duppy.Monad.html" title="Duppy.Monad">Next</a>
</div>
<h1>Module <a href="type_Duppy.Io.html">Duppy.Io</a></h1>

<pre><span class="keyword">module</span> Io: <code class="code">sig</code> <a href="Duppy.Io.html">..</a> <code class="code">end</code></pre><div class="info module top">
Easy parsing of <code class="code">Unix.file_descr</code>.
<p>

 With <a href="Duppy.Io.html#VALread"><code class="code">Duppy.Io.read</code></a>, you can pass a file descriptor to the scheduler,
 along with a marker, and have it run the associated function when the
 marker is found.
<p>

 With <a href="Duppy.Io.html#VALwrite"><code class="code">Duppy.Io.write</code></a>, the schdeduler will try to write recursively to the file descriptor
 the given string.<br>
</div>
<hr width="100%">

<pre><code><span id="TYPEmarker"><span class="keyword">type</span> <code class="type"></code>marker</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmarker.Length"><span class="constructor">Length</span></span> <span class="keyword">of</span> <code class="type">int</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmarker.Split"><span class="constructor">Split</span></span> <span class="keyword">of</span> <code class="type">string</code></code></td>

</tr></table>

<div class="info ">
Type for markers.
<p>

 <code class="code">Split s</code> recognizes all regexp allowed by the 
 <code class="code">Pcre</code> module.<br>
</div>


<pre><span id="TYPEbigarray"><span class="keyword">type</span> <code class="type"></code>bigarray</span> = <code class="type">(char, Bigarray.int8_unsigned_elt, Bigarray.c_layout) Bigarray.Array1.t</code> </pre>
<div class="info ">
Type of <code class="code">Bigarray</code> used here.<br>
</div>


<pre><code><span id="TYPEfailure"><span class="keyword">type</span> <code class="type"></code>failure</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTfailure.Io_error"><span class="constructor">Io_error</span></span></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTfailure.Unix"><span class="constructor">Unix</span></span> <span class="keyword">of</span> <code class="type">Unix.error * string * string</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTfailure.Unknown"><span class="constructor">Unknown</span></span> <span class="keyword">of</span> <code class="type">exn</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTfailure.Timeout"><span class="constructor">Timeout</span></span></code></td>

</tr></table>

<div class="info ">
Different types of failure.
<p>

 <code class="code">Io_error</code> is raised when reading or writing
 returned 0. This usually means that the socket
 was closed.<br>
</div>


<pre><span id="VALread"><span class="keyword">val</span> read</span> : <code class="type">?recursive:bool -><br>       ?init:string -><br>       ?on_error:(string * <a href="Duppy.Io.html#TYPEfailure">failure</a> -> unit) -><br>       ?timeout:float -><br>       priority:'a -><br>       'a <a href="Duppy.html#TYPEscheduler">Duppy.scheduler</a> -><br>       Unix.file_descr -><br>       <a href="Duppy.Io.html#TYPEmarker">marker</a> -> (string * string option -> unit) -> unit</code></pre><div class="info ">
Wrapper to perform a read on a socket and trigger a function when
 a marker has been detected, or enough data has been read.
 It reads recursively on a socket, splitting into strings seperated
 by the marker (if any) and calls the given function on the list of strings.
<p>

 Can be used recursively or not, depending on the way you process strings. 
 Because of Unix's semantic, it is not possible to stop reading
 at first marker, so there can be a remaining string. If not used
 recursively, the second optional argument may contain a remaining
 string. You should then initiate the next read with this value.
<p>

 The <code class="code">on_error</code> function is used when reading failed on the socket.
 Depending on your usage, it can be a hard failure, or simply a lost client.
 The string passed to <code class="code">on_error</code> contains data read before error 
 occured.
<br>
</div>
<div class="param_info"><code class="code">recursive</code> : recursively read and process, default: <code class="code">true</code></div>
<div class="param_info"><code class="code">init</code> : initial string for reading, default: <code class="code">""</code></div>
<div class="param_info"><code class="code">on_error</code> : function used when read failed, default: <code class="code">fun _ -&gt; ()</code></div>
<div class="param_info"><code class="code">timeout</code> : Terminate with <code class="code">Timeout</code> failure if nothing has been read
                after the given amout of time in seconds. More precisely,
                the exception is raised when no character have been read
                and the socket was not close while waiting. Default: wait
                forever.</div>

<pre><span id="VALwrite"><span class="keyword">val</span> write</span> : <code class="type">?exec:(unit -> unit) -><br>       ?on_error:(<a href="Duppy.Io.html#TYPEfailure">failure</a> -> unit) -><br>       ?bigarray:<a href="Duppy.Io.html#TYPEbigarray">bigarray</a> -><br>       ?string:string -><br>       ?timeout:float -><br>       priority:'a -> 'a <a href="Duppy.html#TYPEscheduler">Duppy.scheduler</a> -> Unix.file_descr -> unit</code></pre><div class="info ">
Similar to <code class="code">read</code> but less complex.
 <code class="code">write ?exec ?on_error ?string ?bigarray ~priority scheduler socket</code> 
 write data from <code class="code">string</code>, or from <code class="code">bigarray</code> is no string is given, 
 to <code class="code">socket</code>, and executes <code class="code">exec</code> or <code class="code">on_error</code> if errors occured.
<br>
</div>
<div class="param_info"><code class="code">exec</code> : function to execute after writing, default: <code class="code">fun () -&gt; ()</code></div>
<div class="param_info"><code class="code">on_error</code> : function to execute when an error occured, default: <code class="code">fun _ -&gt; ()</code></div>
<div class="param_info"><code class="code">bigarray</code> : write data from this bigarray, if no <code class="code">string</code> is given</div>
<div class="param_info"><code class="code">string</code> : write data from this string</div>
<div class="param_info"><code class="code">timeout</code> : Terminate with <code class="code">Timeout</code> failure if nothing has been written
                after the given amout of time in seconds. More precisely,
                the exception is raised when no character have been written
                and the socket was not close while waiting. Default: wait
                forever.</div>
</body></html>