<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
  <title>Savonet / Liquidsoap 0.9.2 :: Multimedia Stream Generation</title>
  <link href="../css/new.css" type="text/css" rel="stylesheet" />
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/base/jquery-ui.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <link rel="shortcut icon" href="../favicon.ico" />
  <script>
    google.load("jquery", "1.6.1");
    google.load("jqueryui", "1.8.14");
  </script>
  <script type="text/javascript" src="../js/jQuery.syntax/jquery.syntax.min.js"></script>
  <script type="text/javascript" src="../js/liq-jquery.js"></script>
</head>
<body>
  <div class="menu">
    <ul>
      <li id="menu-developers">
        <a href="https://github.com/savonet/liquidsoap/issues" target="_blank">developers</a></li>
      <li id="menu-flows"><a href="http://flows.liquidsoap.fm/">Flows!</a></li>
      <li id="menu-doc-api-www">
        <a href="reference.html">API</a></li>
      <li id="menu-support">
        <a href="documentation.html">documentation</a></li>
      <li id="menu-download">
        <a href="../download.html">download</a></li>
      <li id="menu-about">
        <a href="../index.html">about</a></li>
    </ul>
  </div>
  <div class="section" id="main">
    <h1>Liquidsoap 0.9.2 : HTTP and harbot inputs.</h1>
    <div class="content">
      <h3>HTTP input</h3>
<p>
Liquidsoap can create a source that pulls its data from an HTTP location. This location can be a distant file or playlist, or an icecast or shoutcast stream.
</p>
<p>
To use it in your script, simply create a source that way:
</p>
<pre class="syntax liq"># url is a HTTP location, like
# http://radiopi.org:8080/reggae
source = input.http(url)
</pre>
<div align="right">
<a href="scripts/http_source.liq">
<img class="grab" src="../images/grab.png" alt="Grab the code!">
</a>
</div></p>
<p>
This operator will pull regulary the given location for its data, so it should be used for locations that are assumed to be available most of the time. If not, it might generate unnecessary traffic and polute the logs. In this case, it is perhaps better to inverse the paradigm and use the <code>input.harbor</code> operator.
</p>
<h3>Harbor input</h3>
<p>
Liquidsoap is also able to receive a source using icecast or shoutcast source protocol with the <code>input.harbor</code> operator. Using this operator, the running liquidsoap will open a network socket and wait for an incoming connection.
</p>
<p>
This operator is very useful to seamlessly add live streams
into your final streams:
you configure the live source client to connect directly to liquidsoap,
and manage the switch to and from the live inside your script.
</p>
<h4>Parameters</h4>
<p>
The global parameters for harbor can be retreived using
<code>liquidsoap --conf-descr-key harbor</code>. They are:
</p>
<ul>
<li>
<code>harbor.bind_addr</code>: IP address on which the HTTP stream receiver should listen. The default is <code>"0.0.0.0"</code>. You can use this parameter to restrict connections only to your LAN.</li>
<li>
<code>harbor.port</code>: Port on which the HTTP stream receiver should listen. Defaults to <code>8005</code>.</li>
<li>
<code>harbor.icy</code>: By default, harbor communicates with source clients using the Icecast2 protocol. Enable this setting if you plan to use the Shoutcast/ICY protocol instead. If so, you should configure the source clients to use port <code>harbor.port</code>, but beware that they will also need access to <code>harbor.port+1</code>.</li>
<li>
<code>harbor.password</code>: Password for source connection. Defaults to <code>"hackme"</code>.</li>
<li>
<code>harbor.username</code>: Username for source connection. Defaults to <code>"source"</code>.</li>
<li>
<code>harbor.timeout</code>: Timeout for source connection, in seconds. Defaults to <code>30.</code>.</li>
</ul>
<p>
You may also set some parameters per-source. You can retreive them using the command <code>liquidsoap -h input.harbor</code>. They are:
</p>
<ul>
<li>
<code>user</code>, <code>password</code>: set a permanent login and password for this harbor source.</li>
<li>
<code>auth</code>: Authenticate the user according to a specific function.</li>
</ul>
<p>
Let <code>auth</code> function is a function, that takes a pair <code>(user,password)</code> and returns a boolean representing whether the user 
should be granted access or not. Typical example can be:
</p>
<pre class="syntax liq">def auth(user,password) = 
  # Call an external process to check 
  # the credentials:
  # The script will return the string 
  # "true" of "false"
  #
  # First call the script
  ret = get_process_lines("/path/to/script \
         --user=#{user} --password=#{password}")
  # Then get the first line of its output
  ret = list.hd(ret)
  # Finally returns the boolean represented 
  # by the output (bool_of_string can also 
  # be used)
  if ret == "true" then
    true
  else
    false
  end
end
</pre>
<div align="right">
<a href="scripts/harbor_auth.liq">
<img class="grab" src="../images/grab.png" alt="Grab the code!">
</a>
</div></p>
<p>
In the case of the <code>ICY</code> (shoutcast) source protocol, there is no <code>user</code> parameter for the source connection. Hence, the user used will be,
by order of priority:
</p>
<ul>
<li>
The <code>user</code> parameter passed to the <code>input.http</code> source, if not empty.</li>
<li>
The <code>harbor.username</code> configuration key.</li>
</ul>
<p>
Hence, when using a custom authentication function, in case of a <code>ICY</code> (shoutcast) connection, the function will receive this value
for the username.
</p>
<h4>Usage</h4>
<p>
When using harbor inputs, you first set the required settings, as described above. Then, you define each source using <code>input.harbor("mountpoint")</code>. This source is faillible and will become available when a source client is connected. 
</p>
<p>
The unlabeled parameter is the mount point that the source client may connect
to. It should be <code>"/"</code> for shoutcast source clients.
</p>
<p>
The source client may use any of the recognized audio input codec. Hence, when using shoucast source clients, you need to have compiled liquidsoap with mp3 decoding support (<code>ocaml-mad</code>)
</p>
<p>
A sample code can be:
</p>
<pre class="syntax liq">set("harbor.bind_addr","0.0.0.0")
set("harbor.port",8000)
set("harbor.password","XXXX")

# Some code...

# This defines a source waiting on mount point 
# /test-harbor
live = input.harbor("test-harbor")

# This is the final stream.
# Uses the live source as soon as available,
# and don't wait for an end of track, since 
# we don't want to cut the beginning of the live
# stream.
#
# You may insert a jingle transition here...
radio = fallback(track_sensitive=false,
                 [live,files])
</pre>
<div align="right">
<a href="scripts/harbor_source.liq">
<img class="grab" src="../images/grab.png" alt="Grab the code!">
</a>
</div></p>
      <div id="footer"> 2003-2017 Savonet team</div>
    </div>
  </div>
  <script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
  <script type="text/javascript" src="../js/search.js"></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-927362-1']);
    _gaq.push(['_trackPageview']);
    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>
